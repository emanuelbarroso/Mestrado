%TCIDATA{LaTeXparent=0,0,relatorio.tex}
                      
\chapter{Construção do Algoritmo \textit{Smart Reservoir} com Utilização do MRST} \label{CapMetodologia}

%[PROPOSTA DE METODOLOGIA PARA \textit{RETROFITTING} DE ROBÔS INDUSTRIAIS]
\section{Introdução}

Este capítulo apresenta as ferramentas empregadas nesta dissertação, além da construção do algoritmo \textit{Smart Reservoir}. Inicialmente, é apresentada a \textit{toolbox} para simulação numérica de reservatórios no \textit{software} MATLAB, o MRST; além da \textit{toolbox}, são apresentados alguns dos modelos numéricos de reservatórios mais utilizados para testes na literatura, e que serão aproveitados para os testes com o algoritmo aqui proposto; como esse algoritmo é destinado a resolver um problema de otimização na produção de petróleo, é apresentada uma função de custo econômico que vai ser o objeto da busca pela solução desejada; esta função, denominada NPV, será apresentada e sua utilização discutida. Posteriormente, será feita uma construção do algoritmo \textit{Smart Reservoir}, desde sua fundamentação inicial até os passos que ele realiza em busca da solução do problema proposto; por fim, é discutido o uso de técnicas de programação paralela para se tentar incrementar o desempenho do \textit{Smart Reservoir}.

\section{\textit{MATLAB Reservoir Simulation Toolbox}}
O MRST --- \textit{MATLAB Reservoir Simulation Toolbox} --- é um conjunto de ferramentas programadas para utilização em conjunto com o \textit{software} MATLAB; trata-se de um conjunto de códigos e definições \textit{open-source} destinados à simulação numérica de reservatórios. Embora não seja primordialmente um simulador, o MRST oferece uma vasta quantidade de estruturas de dados e métodos computacionais de modo que o usuário possa combinar para gerar modelos e ferramentas de simulação em si. O MRST se encontra organizado em duas partes principais\footnote{Ver \cite{site:mrst}.}:
\begin{itemize}
\item Um módulo \textit{\textbf{core}}, em que estão presentes estruturas de dados e funcionalidades básicas;
\item Vários módulos adicionais (\textbf{\textit{add-ons}}), oferecendo discretizações, modelos físicos, simuladores, \textit{solvers}, entre outros.
\end{itemize}

Algumas das principais funcionalidades oferecidas pelo MRST se encontram reunidas a seguir\footnote{Ver \cite{Lie2012}.}: 
\begin{itemize}
\item \textbf{\textit{Grids}:} São estruturas de dados básicas do MRST, com suporte para malhas geométricas básicas, como triangulares, tetraédricas, entre outras.
\item \textbf{Entradas e Saídas:} O MRST possui suporte para entrada de modelos industriais prontos, parâmetros petroquímicos, modelos de fluidos, poços, condições de contorno, parâmetros de simulação, etc.
\item \textbf{Parâmetros:} São estruturas de dados de parâmetros petroquímicos; o MRST possui interface para modelos de fluidos, rotinas para configurar e manipular condições iniciais e de contorno, poços, entre outros.
\item \textbf{Unidades:} O MRST trabalha primariamente com o sistema SI; porém, o mesmo oferece suporte para outras unidades comumente usadas no campo (como o barril); a responsabilidade explícita pela conversão e consistência das unidades é do usuário, normalmente.
\item \textbf{Estado do Reservatório:} O MRST dispõe de estruturas de dados que mostram o estado do reservatório durante a simulação; são mostrados os estados dos poços, pressões, fluxos de fluidos, saturações, entre outros.
\item \textbf{Pós-processamento:} Além das ferramentas de simulação, o MRST possui várias funções de visualização dos resultados alcançados, dados das células e faces, entre outros.
\item \textbf{\textit{Solvers}:} O MRST possui funções que solucionam problemas de fluxo e de transporte de massa, que podem ser combinadas conforme a necessidade.
\item \textbf{Álgebra Linear:} O MRST se aproveita de funções lineares do MATLAB; contudo, outros tipos de \textit{solvers} podem ser utilizados, respeitando-se as convenções do MATLAB.
\end{itemize}

\section{Modelos de Reservatório Utilizados}
Segundo Stags e Herbeck, um modelo de reservatório trata o reservatório real como um composto de vários segmentos individuais (normalmente denominados células), devido à matemática que rege o modelo. De forma simples, um modelo multicelular de reservatório simula a vazão de fluidos de um reservatório de óleo ou gás; embora não possam descrever exatamente o comportamento dos fluidos no ambiente estudado, os modelos de reservatórios produzem aproximações boas e válidas; além disso, os modelos são feitos para representar a vazão intercelular de fluidos em uma, duas ou até três dimensões. Cada célula, em um modelo de reservatório, possui informações próprias de propriedades do conjunto como tamanho, porosidade, permeabilidade, elevação, pressão e saturação dos fluidos presentes. Além disso, são necessários para um modelo os dados de cada poço presente, como localização, índice do poço, tipo do poço, vazões de produção/injeção, limites econômicos, de BHP, entre outros \cite{stags1971}.

No presente trabalho, dentre os vários modelos de reservatório existentes na literatura, dois modelos foram selecionados para a aplicação do \textit{Smart Reservoir}. A escolha foi pautada principalmente pelo tamanho dos modelos, tendo em vista o equipamento disponível para a implementação e a simulação do algoritmo proposto. Além disso, são considerados modelos bifásicos, de apenas óleo e agua. Os modelos selecionados foram o \textit{Egg Model} e o SAIGUP (\textit{Sensistivity Analysis of the Impact of Geological Uncertainties on Production}), apresentados a seguir.

\subsection{\textit{Egg Model}}
Dos modelos selecionados para este estudo, o \textit{Egg Model} é o mais simples. De acordo com Jansen \textit{et al.}, o modelo foi desenvolvido como parte da tese de PHD de  Maarten Zandvliet and Gijs van Essen \cite{eggM}; a primeira referência do \textit{Egg Model} data de 2007, por  Zandvliet \textit{et al.}, contendo apenas uma realização determinística do modelo\footnote{Ver \cite{ZANDVLIET2007186}.}; logo após, em 2009, Van Essen \textit{et al.} utilizaram um conjunto de vários modelos \textit{Egg Model}\footnote{Ver \cite{SPE:RWO}.}. O modelo original ``estocástico'' consiste de 100 realizações de um reservatório canalizado na forma de campos de permeabilidade discreta modelados com $60 \times 60 \times 7 = 25.200$ células, das quais 18.553 são ativas, dando o formato de um ovo ao modelo, justificando seu nome \cite{eggM}. A Tabela \ref{tab:metodo_eggparam} mostra alguns parâmetros utilizados para o \textit{Egg Model}, enquanto que as Figuras \ref{fig:metodo_egg} e \ref{fig:metodo_eggtop} apresentam, respectivamente, um exemplo de realização do \textit{Egg Model} e uma visão de topo do mesmo obtida pelo MRST, destacando os poços existentes.

\begin{figure}[H]
	\centering
	\includegraphics[width=.75\textwidth]{figs/metodologia/metodo_egg}
	\caption{Exemplo de realização do \textit{Egg Model} \cite{eggM}.}\label{fig:metodo_egg}
\end{figure}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=.8\textwidth]{figs/metodologia/metodo_eggtop}
	\caption{Vista de topo do \textit{Egg Model}, evidenciando o posicionamento dos poços.}\label{fig:metodo_eggtop}
\end{figure}

\begin{table}[!ht]
    \centering
    \caption{Propriedades de rocha e fluidos do \textit{Egg Model} \cite{eggM}.}
    %\resizebox{.45\textwidth}{!}{
    \begin{tabular}{|c|l|c|}
        \hline
        \textbf{Símbolo} & \textbf{Variável} & \textbf{Valor} \\ \hline
        $h$ & Altura da malha do modelo & $4 \: \mathrm{m}$ \\ \hline
        $\Delta x, \Delta y$ & Comprimento/Largura da malha do modelo & $8 \: \mathrm{m}$ \\ \hline
        $\varphi$ & Porosidade & $0.2$ \\ \hline
        $c_o$ & Compressibilidade do óleo & $1.0 \times 10^{-10} \: \mathrm{Pa^{-1}}$ \\ \hline
        $c_r$ & Compressibilidade da rocha & $0 \: \mathrm{Pa^{-1}}$ \\ \hline
        $c_w$ & Compressibilidade da água & $1.0 \times 10^{-10} \: \mathrm{Pa^{-1}}$ \\ \hline
        $\mu_o$ & Viscosidade dinâmica do óleo  & $5.0 \times 10^{-3}  \: \mathrm{Pa\,s}$ \\ \hline
        $\mu_w$ & Viscosidade dinâmica da água & $1.0 \times 10^{-3} \: \mathrm{Pa\,s}$ \\ \hline
        $k_{ro}^0$ & Permeabilidade relativa \textit{end-point} do óleo & $0.8$ \\ \hline
        $k_{rw}^0$ & Permeabilidade relativa \textit{end-point} da água & $0.75$ \\ \hline
        $n_o$ & Expoente de Corey do óleo & $4.0$ \\ \hline
        $n_w$ & Expoente de Corey da água & $3.0$ \\ \hline
        $s_{or}$ & Saturação do óleo residual & $0.1$ \\ \hline
        $s_{wc}$ & Saturação da água conata & $0.2$ \\ \hline
        $p_c$ & Pressão Capilar & $0.0 \: \mathrm{Pa}$ \\ \hline
        $\breve{p_r}$ & Pressão de Reservatório inicial (camada de topo) & $40 \times 10^6 \: \mathrm{Pa}$ \\ \hline
        $s_{w,0}$ & Saturação inicial da água & $0.1$ \\ \hline
        $q_{w1}$ & Vazões de injeção de água, por poço & $79.5 \: \mathrm{m^3/dia}$ \\ \hline
        $p_{bh}$ & BHPs dos poços produtores & $39.5 \times 10^6  \: \mathrm{Pa}$ \\ \hline
        $r_{well}$ & Raio do furo dos poços & $0.1 \: \mathrm{m}$ \\ \hline
        $T$ & Tempo de simulação & $3600 \: \mathrm{dias}$ \\ \hline
    \end{tabular} %}
    
    \label{tab:metodo_eggparam}
\end{table}


\subsection{Modelo SAIGUP}
O SAIGUP é, na realidade, um projeto concentrado em reservatórios na costa marítima. De acordo com Carter e Matthews, o projeto SAIGUP envolveu a criação de 400 modelos sedimentológicos que, ao serem acrescidos de falhas geológicas, geram aproximadamente 12000 reservatórios fragmentários sintéticos \cite{saigupCM}. 

A história do estudo do SAIGUP está diretamente relacionada com os esforços da União Europeia em reduzir o tempo de produção do primeiro óleo e melhorar a eficiência de recuperação de hidrocarbonetos em geral, destacam Manzocchi \textit{et al.}; os principais objetivos do projeto são\footnote{Ver \cite{manzocchi2008sensitivity}.}:

\begin{enumerate}
	\item Quantificar as influências da sedimentologia, estrutura e \textit{upscaling}\footnote{Mais detalhes sobre \textit{upscaling} podem ser encontrados em \cite{upscaling}.} em incertezas na estimativa de produção de reservatórios com diferentes propriedades 
	sedimentológicas e estruturais;
	\item Definir medidas, geologicamente relevantes, de heterogeneidade estáticas e dinâmicas de maneira a se obter melhores previsões de produção;
	\item Validar conclusões utilizando dados de produção e reservatórios reais.
\end{enumerate}

O modelo SAIGUP utilizado para esta pesquisa, assim como descrito no MRST, é um modelo \textit{corner-point} constituído por 78720 células nesta realização específica; possui falhas, células inativas, componentes desconectados, porém nenhuma erosão (\textit{pinch-outs}). Tal modelo se situa em uma malha cartesiana cujas dimensões são $40 \times 120 \times 20$ metros; possui 10 poços, sendo 5 injetores, completados nas 12 camadas mais baixas, e 5 produtores, completados nas 14 camadas mais altas. A Figura \ref{fig:metodo_saigup} ilustra o modelo SAIGUP utilizado.

\begin{figure}[H]
	\centering
	\includegraphics[width=.75\textwidth]{figs/metodologia/metodo_saigup}
	\caption{Modelo SAIGUP.}\label{fig:metodo_saigup}
\end{figure}

\section{Função de Custo: NPV}
Como o presente estudo é um problema de otimização relacionado à produção de petróleo, e há o envolvimento de aspectos econômicos, é necessário se estabelecer uma função que seja objeto da otimização: a função objetivo. 

Dos vários métodos de análise de rentabilidade e sucesso de inovações tecnológicas, um dos mais utilizados, provavelmente o mais popular e o mais sofisticado, segundo \v{Z}i\v{z}lavsk\'{y}, é o Valor de Rede Presente, conhecido como \textbf{NPV} (\textit{Net-Present Value}) \cite{ziz2014}. Segundo Gallo, para se avaliar a viabilidade de um projeto, deve-se estimar o quanto é esperado de lucro a partir de investimento, em valores atuais. O NPV é um método largamente utilizado pelos seguintes motivos \cite{SITE:NPV}:

\begin{itemize}
\item O NPV considera o \textit{valor temporal} do dinheiro, isto é, o quanto uma eventual movimentação financeira futura equivale nos dias atuais;
\item O NPV provê um número concreto que os administradores financeiros podem utilizar facilmente para comparar um desembolso inicial com valor de retorno presente.
\end{itemize}

Porém, \v{Z}i\v{z}lavsk\'{y} destaca algumas limitações, muitas vezes subestimadas, do NPV como ferramenta de análise de oportunidades de inovação\footnote{Ver \cite{ziz2014}}:
\begin{itemize}
\item O fator de desconto em projetos de inovação deve ser composto de dois elementos: uma taxa livre de riscos que é normalmente considerada como a taxa de juros ofertada por laços governamentais de curto prazo, e uma taxa de risco \textit{premium} que considera os riscos identificados, sejam eles financeiros, técnicos ou comerciais, associados ao projeto específico.
\item A definição de fluxo de caixa num horizonte de longo prazo --- o cálculo do NPV requer uma definição exata do fluxo de caixa a ser descontado para cada período de tempo considerado na avaliação; tal valor pode ser difícil, se não impossível, de ser determinado em projetos inovadores que possuam grande potencial a longo prazo, mas para os quais os administradores sejam impossibilitados de fazer uma análise adequada. Isso mostra que o NPV, aparentemente, discrimina injustificadamente
projetos de longo prazo e mais arriscados.   
\end{itemize}

A questão a ser discutida agora é: como se calcula o NPV? Gallo cita que, por mais que não se calcule essa função na mão, é útil entender a matemática por trás dela; a Definição \ref{NPVdef} é um esboço matemático dos princípios que regem o NPV\footnote{Ver \cite{SITE:NPV}}.

\begin{definition}\label{NPVdef}
A função NPV pode ser representada em sua forma básica pela expressão
\begin{equation}
	NPV = \sum \frac{FC^{(n)}}{\left(1 + b\right)^n},
\end{equation}
em que $FC$ é o fluxo de caixa total no período de tempo $n$ e $b$ o fator de desconto.
\end{definition}

Dentre os projetos em que o NPV pode ser aplicado para análise a longo prazo, se situa a perspectiva econômica da produção de petróleo. Considerando a Definição \ref{NPVdef}, a variável fluxo de caixa pode ser entendida como uma relação entre a rentabilidade dos produtos obtidos, como petróleo e o gás natural, e os custos envolvidos com a produção e tratamento de materiais indesejáveis e com a adoção de métodos de recuperação secundária, como a injeção de água. Utilizando-se a abordagem proposta por Fonseca \textit{et al.}, o NPV pode ser calculado com a expressão
\begin{equation}\label{NPVReservoir}
	 NPV = \sum_{n=1}^{N_t} \Bigg\lbrace \frac{\Delta t_n}{(1+b)^{\frac{t_n}{365}}} \Bigg[ \sum_{j=1}^{N_P} \left(r_o \overline{q_{o,j}^{(n)}} - c_w \overline{q_{w,j}^{(n)}}\right) - \sum_{k=1}^{N_I} \left(c_{wi} \overline{q_{wi,k}^{(n)}} - c_{gi} \overline{q_{gi,k}^{(n)}}\right) \Bigg]\Bigg\rbrace,
\end{equation} 
em que $N_t$ é o número de passos de tempo do projeto; $N_P$ é o número de poços produtores e $N_I$, o número de poços injetores; $r_o$ é a rentabilidade do óleo (em $\$/STB$)\footnote{A unidade $STB$, conhecida como \textit{Stock Tank Barrel}, equivale a 5.61 pés cúbicos a $60°F$ de temperatura e 14.7 $psi$ de pressão.}, $c_w$ e $c_{wi}$ são, respectivamente, o custo de água produzida e injetada (em $\$/STB$) e $c_gi$ é o custo de gás injetado (em $\$/Mscf$)\footnote{$Mscf$: Milhares de pés cúbicos padrão, isto é, a $60°F$ de temperatura e 14.7 $psi$ de pressão.}; $t_n$ é a medida de tempo ao final de cada passo de simulação e $\Delta t_n$ é o comprimento do passo; $\overline{q_{o,j}^{(n)}}$ e $\overline{q_{w,j}^{(n)}}$ são, respectivamente, as vazões médias de água e óleo no poço produtor $j$ no $n$-ésimo passo de tempo; por fim, $\overline{q_{wi,k}^{(n)}}$ e $\overline{q_{gi,k}^{(n)}}$ representam as vazões médias de água e de gás injetados no poço injetor $k$ no $n$-ésimo passo de tempo --- todas as vazões médias são dadas na unidade $STB/$dia. Ainda se considera, para efeitos de simplificação em problemas de otimização envolvendo engenharia de reservatório e cálculo do NPV, que não há fator de desconto ($b = 0$) \cite{fonseca}. Por fim, como os modelos considerados para este trabalho adotam exclusivamente o método de recuperação secundária por injeção de água, considera-se também que não há vazão de gás injetado; portanto, tem-se que $\overline{q_{gi,k}^{(n)}} = 0,~\forall k,n$.
\section{Algoritmo \textit{Smart Reservoir}}
\subsection{A Função NPV Modificada}
A ideia inicial considerada na concepção do \textit{Smart Reservoir} é incluir parâmetros do reservatório no cálculo do NPV, assim avaliando-se diferentes estratégias de produção a cada momento sem que haja uma simulação inteira da vida do reservatório; em outras palavras, a estratégia de produção ótima é desenvolvida a cada passo de tempo avaliando-se o balanço entre o rendimento e a degradação do reservatório para cada estratégia de médio prazo.

De maneira a alcançar esse objetivo, faz-se necessária uma modificação na definição do NPV. Primeiramente, adotando-se as considerações anteriores de que não há fator de desconto, os custos relativos ao gás podem ser desprezados, uma vez que o algoritmo será testado em modelos \textit{black-oil} contendo apenas água e óleo e o fato de que o problema é contínuo no tempo, a Equação \eqref{NPVReservoir} pode ser reescrita como
\begin{equation}\label{NPVCont}
NPV=\int_{t0}^{tf} \left[ \sum_{j=1}^{N_P} \left(r_o q_{o,j} - c_w q_{w,j}\right) - \sum_{k=1}^{N_I} \left(c_{wi} q_{wi,k}\right) \right]dt.
\end{equation}

Antes de se continuar com o trato da função objetivo, faz-se necessária uma simplificação, separando-se o NPV global em uma componente por poço produtor; desta forma, o fluxo de caixa pode ser escrito, a partir das Equações \ref{NPVdef} e \ref{NPVCont}, como
\begin{equation}\label{eq:cashFlow}
C_F(t) = \sum_{j=1}^{N_P} \left(r_o q(t)_{o,j} - c_w q(t)_{w,j}\right) - \sum_{k=1}^{N_I} \left(c_{wi}q(t)_{wi,k}\right).
\end{equation}
O fluxo de caixa ainda pode ser separado para cada poço produtor; utilizando-se os mesmos como índices, a Equação \eqref{eq:cashFlow} pode ser reescrita, para cada poço produtor $P$, como

\begin{equation}\label{eq:wellCashFlow}
C_F(t,P) = \left(r_o q(t)_{o,P} - c_w q(t)_{w,P}\right) - \sum_{k=1}^{N_I} \left(c_{wi} q(t)_{wi,k}\right).
\end{equation}

Devido ao fato de que as zonas de drenagem de cada poço produtor possuem interseções pequenas entre si, pode-se considerar os comportamentos dinâmicos de cada produtor fracamente conectados aos demais. Portanto, pode-se escrever o NPV para cada poço $P$ como se segue:

\begin{equation}\label{eq:WellNPVDef}
NPV(t,P) = \int_{t_0}^{t_n} C_F(t,P)dt.
\end{equation}

O problema de se obter o melhor NPV a cada passo de tempo pode ser visto como uma questão de se controlar cada poço individualmente de maneira que seu NPV --- como define a Equação \eqref{eq:WellNPVDef} --- seja maximizado; entretanto, tal função objetivo pode ser reescrita para que haja um melhor uso dos parâmetros do reservatório, assim fazendo-se uma melhor avaliação da estratégia de produção a cada passo de tempo. Uma forma de se fazer isso é por meio da mudança da variável de integração; ao invés de se utilizar o tempo, passa-se a considerar a saturação na vizinhança dos poços, já que ela pode ser obtida facilmente por meio das vazões de óleo e água. Portanto, ao invés de se utilizar a Equação \eqref{eq:WellNPVDef}, a função objetivo utilizada para se determinar o controle de cada poço produtor passa a ser

\begin{equation}\label{eq:ModWellNPVDef}
\widetilde{NPV}(s,P) = \int_{s_0}^{s_f} \frac{C_F(s,P)}{ds/dt}ds,
\end{equation}
em que $ds/dt$ é a variação temporal da saturação no poço $P$. Esta integral possui contornos mais identificáveis, visto que a saturação inicial é conhecida e o final do intervalo é a menor saturação de óleo viável para se produzir. Sendo assim, a Equação \eqref{eq:ModWellNPVDef} é a função a ser testada em cada poço, com vistas de se obter a melhor estratégia de produção durante a vida útil do reservatório.

\subsection{Núcleo do Algoritmo}
O problema de se encontrar a melhor estratégia de controle em cada poço de maneira a se obter o melhor NPV possível durante uma simulação de reservatório não é trivial; trata-se de um problema de complexidade no mínimo exponencial, podendo ser classificado como um problema NP-completo\footnote{Maiores detalhes sobre problemas NP podem ser encontrados em \cite{npDef}.}.

Além das dificuldades computacionais de se encontrar um esquema ótimo de produção para um dado reservatório, há as dificuldades matemáticas; é inviável tentar se obter, por exemplo, as zonas de convexidade de uma função como o NPV considerando um reservatório, uma vez que suas variáveis dependentes se comportam de acordo com relações matemáticas não tão triviais, como a lei de Darcy. Como não se pode fazer nenhuma afirmação sobre a convexidade da função objetivo, não se pode aplicar o Teorema \ref{theoMinConv} nem as condições KKT para se realizar a otimização desejada. Tendo-se ainda o fato de que o NPV não é uma função facilmente diferenciável, e não se pode afirmar, com certeza, que ela é Gâteaux ou Fréchet diferenciável, de acordo com os conceitos da Seção \ref{subsec:otimconcepts}, não é trivial utilizar métodos de gradiente descendente nessa situação.

A ideia da solução proposta é fazer avaliações de diferentes estratégias de produção a médio prazo, a cada passo de tempo; contudo, não é prudente tentar considerar todas os valores possíveis para o controle dos poços, fazendo-se a técnica da ``força bruta''; tal alternativa é inviável computacionalmente. Ao invés de se fazer uma busca exaustiva da melhor configuração dos poços, pode-se escolher, de um conjunto finito de estratégias, uma que produza o melhor resultado, em termos de NPV, em determinado passo de tempo; essa estratégia escolhida se torna o ponto de partida para outro conjunto finito de estratégias a serem testadas no próximo passo, repetindo-se esse algoritmo durante a vida útil do reservatório. A Figura \ref{fig:searchStrategies} ilustra o comportamento de cada forma de busca de soluções até aqui descrita.

\begin{figure}[!ht]
	\centering
	\begin{subfigure}[b]{.45\textwidth}
		\includegraphics[width=\textwidth]{figs/metodologia/metodo_buscaE}
		\caption{Busca exaustiva}
		\label{bruteSearch}
	\end{subfigure}
	~
	\begin{subfigure}[b]{.45\textwidth}
		\includegraphics[width=\textwidth]{figs/metodologia/metodo_buscaA}
		\caption{Busca alternativa}
		\label{altSearch}
	\end{subfigure}
\caption{Estratégias de busca de solução \cite{eugenioSmart}.}
\label{fig:searchStrategies}
\end{figure}

Pode-se entender o \textit{Smart Reservoir} como um algoritmo de busca de caminho ótimo de controle dos poços produtores; tal controle é dado pela variação de pressão em cada poço. A cada passo de tempo, são examinadas algumas possibilidades de pressão de todos os poços produtores, calculando-se o NPV modificado de cada situação examinada. O conjunto de pressões que resulta no melhor resultado da função objetivo é então usado como base para a geração do próximo conjunto de possibilidades de controle, a ser avaliado no próximo instante de tempo --- a Figura \ref{altSearch}. Após cada passo do algoritmo, é calculado, então, o NPV segundo a Equação \eqref{NPVReservoir}, que é salvo. A condição de parada do \textit{Smart Reservoir} está diretamente relacionada ao NPV; caso se detecte que, em determinado tempo, o NPV se tornou negativo, isto é, passa-se a ocorrer prejuízos na produção, o algoritmo é interrompido.

A escolha de possibilidades de controle para os poços produtores, por meio de suas pressões, segue um padrão específico: a partir da condição inicial, cada uma das estratégias de controle a ser testada é obtida a partir de uma variação nas pressões de cada poço utilizando-se uma taxa específica de variação, chamada $\delta_W$. Assumindo-se que cada conjunto de possibilidades tenha $n_{bhp}$ vetores de pressão dos poços, e $\mathbf{p_W^{(n)}}$ o estado de controle dos poços no n-ésimo passo de tempo, o conjunto de pressões a serem testadas no próximo instante é dado por
\begin{equation}\label{eq:pp1}
	\mathbf{p_W^{(n+1)}} = \mathbf{p_W^{(n)}} \pm N\delta_W,
\end{equation}
em que $N$ é um número inteiro que pode ser obtido utilizando-se a relação
\begin{equation}
	N = \left \lfloor \frac{n_{bhp}+1}{2} \right \rfloor - i,~~i = 1,\ldots,n_{bhp}.
\end{equation}
No caso especial da primeira iteração, em que se deseja prioritariamente abrir os poços, isto é, diminuir sua pressão de maneira que se aumente a vazão de fluidos do reservatório --- no início, a saturação do óleo é maior; portanto, aumentando-se a vazão dos poços, aumenta-se a produção dos hidrocarbonetos, o que é desejável ---, o cálculo das pressões se dá da seguinte forma:

\begin{equation}\label{eq:pp2}
\mathbf{p_W^{(1)}} = \mathbf{p_W^{(0)}} - i\delta_W,~~i = 0,\ldots,n_{bhp}-1.	
\end{equation}


Por fim, analisando-se as entradas e as saídas do \textit{Smart Reservoir}, conclui-se que as entradas consistem primariamente dos parâmetros do reservatório e o estado inicial das pressões em cada poço, além da formulação da taxa de variação. As saídas de interesse são o NPV total estimado utilizando-se a Equação \eqref{NPVReservoir}, o número de passos de tempo em que a produção se manteve viável e uma matriz contendo todas as pressões de cada poço obtidas durante o algoritmo. O \textit{Smart Reservoir}, em resumo, pode ser escrito da seguinte forma:

\begin{enumerate}
	\item Inicialize o reservatório e as pressões de cada poço;
	\item Estabeleça $n_{bhp}$ vetores de pressão, conforme as Equações \eqref{eq:pp1} e \eqref{eq:pp2};
	\item Para cada vetor de pressão obtido, simule o reservatório e calcule o NPV modificado com a Equação \eqref{eq:ModWellNPVDef} para cada poço;
	\item Atualize as pressões de cada poço com aquelas que resultaram nos melhores valores do NPV modificado;
	\item Salve as pressões obtidas em uma matriz de controle;
	\item Simule novamente o reservatório, utilizando as pressões ótimas obtidas, e avalie o NPV normal por meio da Equação \eqref{NPVReservoir};
	\item Atualize as taxas de variação, se necessário, e as condições iniciais do reservatório para a próxima simulação;
	\item Se o NPV normal for positivo, incremente o passo de tempo e volte ao Passo 2; caso contrário, prosseguir com o próximo Passo;
	\item Obter a soma cumulativa de todos os NPVs normais positivos;
	\item Salve o NPV total, o número de passos de tempo e a matriz de controle;
	\item Fim do algoritmo.
\end{enumerate}

Da maneira como está definido, percebe-se que o \textit{Smart Reservoir} é puramente baseado em avaliações de NPV por meio das pressões dos poços. Porém, esse algoritmo pode ser melhorado, adicionando-se outras considerações diretamente relacionadas ao desempenho do reservatório e a existência de situações que podem levar a inconsistências numéricas. Alguns adendos já considerados nesta pesquisa são apresentados na Seção a seguir.

\subsection{Métodos Adicionais}
\section{O \textit{Smart Reservoir} e a Programação Paralela}